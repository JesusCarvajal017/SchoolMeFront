<div class="ajustes-wrapper">
  <div class="ajustes-card">
    <!-- Header del componente -->
    <div class="ajustes-header">
      <h1 class="ajustes-title">
        <span class="icon">丘뙖잺</span> Ajustes de Seguridad
      </h1>
      <p class="ajustes-subtitle">
        Gestiona tu correo electr칩nico y contrase침a de forma segura
      </p>
    </div>

    <!-- Contenido principal -->
    <div class="ajustes-grid">
      <!-- Actualizar correo -->
      <div class="ajustes-section" [class.loading]="loadingEmail">
        <div class="section-header">
          <h2 class="section-title">
            <span class="icon">游닎</span> Actualizar Correo
          </h2>
          <div class="section-line"></div>
        </div>
        
        <form [formGroup]="emailForm" (ngSubmit)="submitEmail()" class="ajustes-form" novalidate>
          <div class="form-group" 
               [class.has-error]="emailForm.get('email')?.invalid && (emailForm.get('email')?.touched || emailForm.get('email')?.dirty)"
               [class.has-success]="emailForm.get('email')?.valid && emailForm.get('email')?.touched">
            <label for="email">NUEVO CORREO ELECTR칍NICO</label>
            <input 
              id="email" 
              type="email" 
              formControlName="email" 
              placeholder="ejemplo@correo.com"
              autocomplete="email" />
            
            <div *ngIf="emailForm.get('email')?.invalid && (emailForm.get('email')?.touched || emailForm.get('email')?.dirty)" 
                 class="error-text">
              <span *ngIf="emailForm.get('email')?.errors?.['required']">
                El correo es obligatorio
              </span>
              <span *ngIf="emailForm.get('email')?.errors?.['email']">
                Formato de correo inv치lido
              </span>
            </div>
          </div>
          
          <button 
            type="submit" 
            class="btn-primary" 
            [disabled]="loadingEmail || emailForm.invalid">
            <span *ngIf="!loadingEmail">Actualizar Correo</span>
            <span *ngIf="loadingPassword" class="loading-spinner"></span>
          </button>
        </form>
      </div>

      <!-- Cambiar contrase침a -->
      <div class="ajustes-section" [class.loading]="loadingPassword">
        <div class="section-header">
          <h2 class="section-title">
            <span class="icon">游댐</span> Cambiar Contrase침a
          </h2>
          <div class="section-line"></div>
        </div>
        
        <form [formGroup]="passwordForm" (ngSubmit)="submitPassword()" class="ajustes-form" novalidate>
          <div class="form-group"
               [class.has-error]="passwordForm.get('passwordNew')?.invalid && (passwordForm.get('passwordNew')?.touched || passwordForm.get('passwordNew')?.dirty)"
               [class.has-success]="passwordForm.get('passwordNew')?.valid && passwordForm.get('passwordNew')?.touched">
            <label for="passwordNew">NUEVA CONTRASE칌A</label>
            <input 
              id="passwordNew" 
              type="password" 
              formControlName="passwordNew" 
              placeholder="M칤nimo 8 caracteres, una may칰scula y un car치cter especial"
              autocomplete="new-password" />
            
            <div *ngIf="passwordForm.get('passwordNew')?.invalid && (passwordForm.get('passwordNew')?.touched || passwordForm.get('passwordNew')?.dirty)" 
                 class="error-text">
              <span *ngIf="passwordForm.get('passwordNew')?.errors?.['required']">
                La contrase침a es obligatoria
              </span>
              <span *ngIf="passwordForm.get('passwordNew')?.errors?.['minlength']">
                Debe tener al menos 8 caracteres
              </span>
              <span *ngIf="passwordForm.get('passwordNew')?.errors?.['pattern']">
                Debe incluir al menos una may칰scula y un car치cter especial
              </span>
            </div>
          </div>

          <div class="form-group"
               [class.has-error]="passwordForm.get('passwordConfirm')?.invalid && (passwordForm.get('passwordConfirm')?.touched || passwordForm.get('passwordConfirm')?.dirty)"
               [class.has-success]="passwordForm.get('passwordConfirm')?.valid && passwordForm.get('passwordConfirm')?.touched && !passwordForm.errors?.['mismatch']">
            <label for="passwordConfirm">CONFIRMAR CONTRASE칌A</label>
            <input 
              id="passwordConfirm" 
              type="password" 
              formControlName="passwordConfirm" 
              placeholder="Repite la contrase침a"
              autocomplete="new-password" />
            
            <div *ngIf="passwordForm.get('passwordConfirm')?.invalid && (passwordForm.get('passwordConfirm')?.touched || passwordForm.get('passwordConfirm')?.dirty)" 
                 class="error-text">
              <span *ngIf="passwordForm.get('passwordConfirm')?.errors?.['required']">
                La confirmaci칩n es obligatoria
              </span>
            </div>
          </div>

          <div *ngIf="passwordForm.errors?.['mismatch'] && (passwordForm.get('passwordNew')?.touched || passwordForm.get('passwordConfirm')?.touched)" 
               class="error-text">
            Las contrase침as no coinciden
          </div>

          <button 
            type="submit" 
            class="btn-primary" 
            [disabled]="loadingPassword || passwordForm.invalid">
            <span *ngIf="!loadingPassword">Cambiar Contrase침a</span>
            <span *ngIf="loadingPassword" class="loading-spinner"></span>
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal de resultado -->
  <div class="modal-backdrop" *ngIf="showResultModal" (click)="closeResultModal()">
    <div class="result-modal" [ngClass]="modalType" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ modalType === 'success' ? '칄xito' : 'Error' }}</h3>
        <button class="close-btn" (click)="closeResultModal()" type="button">
          &times;
        </button>
      </div>
      
      <div class="modal-body">
        <p>{{ modalMessage }}</p>
      </div>
      
      <div class="modal-footer">
        <button class="btn-primary" (click)="closeResultModal()" type="button">
          Aceptar
        </button>
      </div>
    </div>
  </div>
</div>